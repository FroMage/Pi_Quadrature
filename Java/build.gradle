apply plugin: 'java'

apply plugin: 'eclipse'
//apply plugin: 'idea'

repositories {
    mavenCentral()
    flatDir { dirs System.properties.'user.home' + '/lib/Java/DataRush/lib' }
    mavenLocal()
}

dependencies {
    compile 'org.codehaus.jcsp:jcsp:1.1-rc5'
    compile 'org.codehaus.gpars:gpars:1.0.0'
    compile 'org.codehaus.groovy:groovy-all:2.0.6'
    compile 'org.functionaljava:functionaljava:3.1'
    compile ':datarush-library:5.1.0-49'
}

sourceCompatibility = '8'

defaultTasks 'classes'

new File("${projectDir}/src/main/java/uk/org/winder/pi_quadrature").eachFileMatch(~/Pi_.*\.java/) { filename ->
    final root = filename.name.replaceFirst(/\.java$/, '')
    final className = 'uk.org.winder.pi_quadrature.' + root
    task ('run_' + root, dependsOn: 'classes') << {
        final process = ("java -cp build/classes/main ${className}").execute()
        process.in.eachLine{line -> println line}
        assert process.waitFor() == 0
    }
}

task wrapper (type:Wrapper) {
    gradleVersion = '1.3'
}

/*
idea {
    module {
        excludeDirs += file('gradle/') // Gradle directory including the wrapper subdirectory.
        excludeDirs += file('.settings/') // Eclipse settings directory.
        excludeDirs += file('bin') // Eclipse compilation directory.
        excludeDirs += file('out') // IDEA compilation directory.
        excludeDirs += file('build') // Gradle compilation directory.
        excludeDirs += file('docs') // Jon's book directory
    }
    project {
        ext.javaVersion = '1.8'
        ipr {
            withXml { provider ->
                def node = provider.asNode()
                def vcsConfig = node.component.find { it.'@name' == 'VcsDirectoryMappings' }
                vcsConfig.mapping[0].'@vcs' = 'Git'
                def gradleSettings = node.appendNode('component', [name: 'GradleSettings'])
                gradleSettings.appendNode('option', [name: 'SDK_HOME', value: gradle.gradleHomeDir.absolutePath])
            }
            whenMerged { project ->
                project.jdk.languageLevel = 'JDK_1_8'
            }
        }
    }
}
*/
